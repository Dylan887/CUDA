# ç¥ç»ç½‘ç»œæ„å»ºåŸç†(ä»¥MINISTä¸ºä¾‹)

åœ¨ MNIST æ‰‹å†™æ•°å­—è¯†åˆ«ä»»åŠ¡ä¸­ï¼Œæ„å»ºç¥ç»ç½‘ç»œå¹¶è®­ç»ƒæ¨¡å‹æ¥è¿›è¡Œåˆ†ç±»æ˜¯ç»å…¸çš„æ·±åº¦å­¦ä¹ åº”ç”¨ã€‚MNIST æ•°æ®é›†åŒ…å« 28x28 åƒç´ çš„æ‰‹å†™æ•°å­—å›¾åƒï¼ˆ0-9ï¼‰ï¼Œä»»åŠ¡æ˜¯æ„å»ºä¸€ä¸ªç¥ç»ç½‘ç»œï¼Œèƒ½å¤Ÿæ ¹æ®è¾“å…¥çš„å›¾åƒé¢„æµ‹å¯¹åº”çš„æ•°å­—ã€‚æœ¬æ–‡å°†é€šè¿‡è¯¥æ¡ˆä¾‹è¯¦ç»†ä»‹ç»ç¥ç»ç½‘ç»œçš„é€»è¾‘æ¡†æ¶å’Œå…·ä½“çš„è®¡ç®—æµç¨‹ã€‚
## ç¥ç»ç½‘ç»œæ„å»ºæ¡†æ¶

**1.æ•°æ®é¢„å¤„ç†**
* å°†è¾“å…¥æ•°æ®è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ï¼ˆå½’ä¸€åŒ–ï¼‰ï¼Œå¹¶å°†æ ‡ç­¾è½¬æ¢ä¸ºé€‚åˆæ¨¡å‹çš„æ ¼å¼ï¼ˆ one-hot ç¼–ç ï¼‰ã€‚

**2.æ¨¡å‹æ„å»º**
* **a.è¾“å…¥å±‚**ï¼šå®šä¹‰è¾“å…¥çš„å¤§å°ï¼ˆå°† 28x28 çš„å›¾åƒå±•å¹³ä¸º 784 ç»´å‘é‡ï¼‰ã€‚
* **b.éšè—å±‚**ï¼šæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªéšè—å±‚ï¼Œæ¯å±‚åŒ…å«ä¸€å®šæ•°é‡çš„ç¥ç»å…ƒï¼Œå¹¶åº”ç”¨æ¿€æ´»å‡½æ•°ï¼ˆå¦‚ ReLUï¼‰[å®é™…ä¸Šç¥ç»å…ƒç›¸å½“äºç»´æ•°ï¼Œè¯¥è¿‡ç¨‹å³æ˜¯å¯¹åŸç‰¹å¾ç»´æ•°è¿›è¡Œæ‰©ç»´æˆ–é™ç»´]ã€‚
* **c.è¾“å‡ºå±‚**ï¼šå®šä¹‰è¾“å‡ºå±‚çš„ç¥ç»å…ƒæ•°é‡ï¼ˆä¸åˆ†ç±»ç±»åˆ«ä¸€è‡´ï¼‰ï¼Œé€šå¸¸ä½¿ç”¨ Softmax å‡½æ•°å°†è¾“å‡ºè½¬æ¢ä¸ºæ¦‚ç‡ã€‚

**3.å‰å‘ä¼ æ’­**

* æ‰§è¡Œè¾“å…¥å±‚åˆ°éšè—å±‚ã€å†åˆ°è¾“å‡ºå±‚çš„çŸ©é˜µä¹˜æ³•å’Œæ¿€æ´»å‡½æ•°ï¼Œè®¡ç®—è¾“å‡ºå€¼ã€‚

**4.æŸå¤±å‡½æ•°è®¡ç®—**

* ä½¿ç”¨äº¤å‰ç†µç­‰æŸå¤±å‡½æ•°ï¼Œè®¡ç®—é¢„æµ‹è¾“å‡ºä¸çœŸå®æ ‡ç­¾ä¹‹é—´çš„è¯¯å·®ã€‚

**5.åå‘ä¼ æ’­**

* é€šè¿‡é“¾å¼æ³•åˆ™ï¼Œè®¡ç®—æŸå¤±å‡½æ•°å¯¹æ¯ä¸ªå‚æ•°çš„åå¯¼æ•°ï¼Œå¹¶æ›´æ–°æƒé‡å’Œåç½®é¡¹ã€‚

**6.ä¼˜åŒ–å™¨æ›´æ–°**

* ä½¿ç”¨ä¼˜åŒ–å™¨ï¼ˆå¦‚ SGDã€Adamï¼‰åŸºäºè®¡ç®—çš„æ¢¯åº¦æ›´æ–°æ¨¡å‹å‚æ•°ï¼Œé™ä½æŸå¤±å€¼ã€‚

**7.è¿­ä»£è®­ç»ƒ**

* ä¸æ–­é‡å¤å‰å‘ä¼ æ’­ã€æŸå¤±è®¡ç®—å’Œåå‘ä¼ æ’­ï¼Œç›´åˆ°æŸå¤±æ”¶æ•›æˆ–è¾¾åˆ°è®¾å®šçš„è®­ç»ƒè½®æ¬¡ã€‚

**8.æ¨¡å‹è¯„ä¼°ä¸é¢„æµ‹**

* è®­ç»ƒå®Œæˆåï¼Œç”¨æµ‹è¯•æ•°æ®è¯„ä¼°æ¨¡å‹æ€§èƒ½ï¼Œå¹¶è¿›è¡Œæ–°æ•°æ®çš„é¢„æµ‹ã€‚

![alt text](/images/2024-09-20_164314.jpg)

![alt text](/images/2024-09-20_193110.jpg)


## ç¥ç»ç½‘ç»œçš„å…·ä½“è®¡ç®—æµç¨‹



æ¥ä¸‹æ¥ä»¥MINISTæ‰‹å†™æ•°å­—è¯†åˆ«ä¸ºä¾‹ï¼Œæ¨¡æ‹Ÿç¥ç»ç½‘ç»œæ„å»ºçš„å…·ä½“è®¡ç®—è¿‡ç¨‹ã€‚

å‡è®¾è¯¥ç½‘ç»œåŒ…å« **ä¸¤ä¸ªéšè—å±‚**ï¼Œæ¯ä¸ªéšè—å±‚æœ‰ **25 ä¸ªç¥ç»å…ƒ**ï¼Œæœ€åçš„è¾“å‡ºå±‚ä¸º **10 ä¸ªç¥ç»å…ƒ**ã€‚

### 1. å‰å‘ä¼ æ’­ï¼ˆForward Propagationï¼‰

#### **1.1è¾“å…¥å±‚åˆ°ç¬¬ä¸€ä¸ªéšè—å±‚ï¼š**

* **è¾“å…¥å¤§å°**ï¼šå‡è®¾è¾“å…¥å›¾åƒæ˜¯ 28x28 çš„åƒç´ çŸ©é˜µï¼Œå±•å¹³æˆ 784 ç»´çš„å‘é‡ã€‚$$x \in \mathbb{R}^{784 \times 1}$$

* **æƒé‡çŸ©é˜µ**ï¼šè¿æ¥è¾“å…¥å±‚åˆ°ç¬¬ä¸€ä¸ªéšè—å±‚çš„æƒé‡çŸ©é˜µï¼Œå¤§å°ä¸º 25x784ï¼Œ[å› ä¸ºç‰¹å¾å‘é‡æ˜¯åˆ—å‘é‡ï¼Œæ‰€ä»¥éœ€è¦è½¬ç½®]ã€‚$$W_1 \in \mathbb{R}^{25 \times 784}$$

* **åç½®é¡¹**ï¼šç¬¬ä¸€ä¸ªéšè—å±‚çš„åç½®é¡¹ï¼Œå¤§å°ä¸º 25x1ã€‚$$b_1 \in \mathbb{R}^{25 \times 1}$$
* **æ¿€æ´»å‡½æ•°**ï¼šä½¿ç”¨ ReLU æ¿€æ´»å‡½æ•°ã€‚

**è®¡ç®—æ­¥éª¤**ï¼š

* æ‰§è¡ŒçŸ©é˜µä¹˜æ³•$$z_1 = W_1 \cdot x + b_1$$



$z_1$ çš„ç»´åº¦æ˜¯ 25x1ã€‚

* åº”ç”¨ ReLU æ¿€æ´»å‡½æ•°ï¼š$$h_1 = \text{ReLU}(z_1)$$



å…¶ä¸­ï¼š$$\text{ReLU}(z_1) = \max(0, z_1)$$



* **ç»“æœ**ï¼šç¬¬ä¸€ä¸ªéšè—å±‚çš„è¾“å‡º $h_1$ æ˜¯ 25 ç»´çš„å‘é‡ã€‚
![alt text](/images/2024-09-20_193035.jpg)

 #### **1.2ç¬¬ä¸€ä¸ªéšè—å±‚åˆ°ç¬¬äºŒä¸ªéšè—å±‚ï¼š**

* **æƒé‡çŸ©é˜µ**ï¼šè¿æ¥ç¬¬ä¸€ä¸ªéšè—å±‚åˆ°ç¬¬äºŒä¸ªéšè—å±‚çš„æƒé‡çŸ©é˜µï¼Œå¤§å°ä¸º 25x25ã€‚$$W_2 \in \mathbb{R}^{25 \times 25}$$



* **åç½®é¡¹**ï¼šç¬¬äºŒä¸ªéšè—å±‚çš„åç½®é¡¹ï¼Œå¤§å°ä¸º 25x1ã€‚$$b_2 \in \mathbb{R}^{25 \times 1}$$



**è®¡ç®—æ­¥éª¤**ï¼š

* æ‰§è¡ŒçŸ©é˜µä¹˜æ³•$$z_2 = W_2 \cdot h_1 + b_2$$



$z_2$çš„ç»´åº¦æ˜¯ 25x1ã€‚

* åº”ç”¨ ReLU æ¿€æ´»å‡½æ•°ï¼š$$h_2 = \text{ReLU}(z_2)$$		



* **ç»“æœ**ï¼šç¬¬äºŒä¸ªéšè—å±‚çš„è¾“å‡º $h_2$ ä»ç„¶æ˜¯ 25 ç»´çš„å‘é‡ã€‚

#### **1.3ç¬¬äºŒä¸ªéšè—å±‚åˆ°è¾“å‡ºå±‚ï¼š**

* **æƒé‡çŸ©é˜µ**ï¼šè¿æ¥ç¬¬äºŒä¸ªéšè—å±‚åˆ°è¾“å‡ºå±‚çš„æƒé‡çŸ©é˜µï¼Œå¤§å°ä¸º 10x25ã€‚$$W_3 \in \mathbb{R}^{10 \times 25}$$



* **åç½®é¡¹**ï¼šè¾“å‡ºå±‚çš„åç½®é¡¹ï¼Œå¤§å°ä¸º 10x1ã€‚$b_3 \in \mathbb{R}^{10 \times 1}$



**è®¡ç®—æ­¥éª¤**ï¼š

* æ‰§è¡ŒçŸ©é˜µä¹˜æ³•$$z_3 = W_3 \cdot h_2 + b_3$$



$z_3$çš„ç»´åº¦æ˜¯ 10x1ã€‚

* åº”ç”¨ Softmax å‡½æ•°å°†è¾“å‡ºè½¬æ¢ä¸ºæ¦‚ç‡ï¼š$$\text{Softmax}(z_3)_i = \frac{e^{z_{3i}}}{\sum_{j=1}^{10} e^{z_{3j}}}$$



Softmax è¾“å‡ºæ˜¯ 10 ç»´çš„æ¦‚ç‡å‘é‡ï¼Œè¡¨ç¤ºè¾“å…¥å±äº 0-9 çš„æ¦‚ç‡ã€‚

### 2. æŸå¤±è®¡ç®—

ä½¿ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°æ¥è®¡ç®—é¢„æµ‹è¾“å‡ºä¸çœŸå®æ ‡ç­¾ä¹‹é—´çš„è¯¯å·®,å‡è®¾çœŸå®æ ‡ç­¾æ˜¯ one-hot ç¼–ç çš„å‘é‡$y \in \mathbb{R}^{10}$,å…¶ä¸­,
$y_i = 1$ è¡¨ç¤ºçœŸå®ç±»åˆ«ï¼Œ$p_i = \text{Softmax}(z_3)_i$ è¡¨ç¤ºæ¨¡å‹å¯¹ç±»åˆ« $i$ çš„é¢„æµ‹æ¦‚ç‡ã€‚
![alt text](/images/2024-09-20_192500.jpg)

**äº¤å‰ç†µæŸå¤±å…¬å¼**ï¼š$$L = -\sum_{i=1}^{10} y_i \log(p_i)$$



**æŸå¤±è®¡ç®—æ­¥éª¤**ï¼š

* å¯¹äºæ¯ä¸€ä¸ªæ ·æœ¬ï¼Œè®¡ç®—é¢„æµ‹ç±»åˆ«å¯¹åº”çš„æ¦‚ç‡ $p_i$ çš„å¯¹æ•°ï¼Œç„¶åè®¡ç®—æŸå¤± $L$ã€‚

### 3. åå‘ä¼ æ’­ï¼ˆBackward Propagationï¼‰

åå‘ä¼ æ’­çš„ç›®æ ‡æ˜¯é€šè¿‡é“¾å¼æ³•åˆ™è®¡ç®—æŸå¤±å‡½æ•°å¯¹æ¯å±‚æƒé‡çš„åå¯¼æ•°ï¼Œå¹¶æ›´æ–°æƒé‡çŸ©é˜µã€‚

#### 3.1è¾“å‡ºå±‚åˆ°ç¬¬äºŒä¸ªéšè—å±‚ï¼š

* **è®¡ç®—æŸå¤±å¯¹è¾“å‡ºå±‚çš„å¯¼æ•°**ï¼š$$\frac{\partial L}{\partial z_3} = \text{Softmax}(z_3) - y$$



* **è®¡ç®—æŸå¤±å¯¹$W_3$çš„å¯¼æ•°**ï¼š$$\frac{\partial L}{\partial W_3} = \frac{\partial L}{\partial z_3} \cdot h_2^T$$



* **è®¡ç®—æŸå¤±å¯¹$b_3$çš„å¯¼æ•°**ï¼š$$\frac{\partial L}{\partial b_3} = \frac{\partial L}{\partial z_3}$$



#### 3.2ç¬¬äºŒä¸ªéšè—å±‚åˆ°ç¬¬ä¸€ä¸ªéšè—å±‚ï¼š

* **æŸå¤±ä¼ æ’­åˆ°ç¬¬äºŒå±‚çš„è¾“å‡º$h_2$**ï¼š$$\frac{\partial L}{\partial h_2} = W_3^T \cdot \frac{\partial L}{\partial z_3}$$



* **è®¡ç®— ReLU æ¿€æ´»å‡½æ•°çš„å¯¼æ•°**ï¼š$$\frac{\partial L}{\partial z_2} = \frac{\partial L}{\partial h_2} \cdot \text{ReLU}'(z_2)$$



å…¶ä¸­ï¼š$$\text{ReLU}'(z_2) = 
\begin{cases} 
1 & \text{if } z_2 > 0 \\
0 & \text{if } z_2 \leq 0 
\end{cases}$$



* **è®¡ç®—æŸå¤±å¯¹$W_2$çš„å¯¼æ•°**ï¼š$$\frac{\partial L}{\partial W_2} = \frac{\partial L}{\partial z_2} \cdot h_1^T$$



* **è®¡ç®—æŸå¤±å¯¹$b_2$çš„å¯¼æ•°**ï¼š$$\frac{\partial L}{\partial b_2} = \frac{\partial L}{\partial z_2}$$



#### 3.3ç¬¬ä¸€ä¸ªéšè—å±‚åˆ°è¾“å…¥å±‚ï¼š

* **æŸå¤±ä¼ æ’­åˆ°ç¬¬ä¸€å±‚çš„è¾“å‡º$h_1$**ï¼š$$\frac{\partial L}{\partial h_1} = W_2^T \cdot \frac{\partial L}{\partial z_2}$$



* **è®¡ç®— ReLU æ¿€æ´»å‡½æ•°çš„å¯¼æ•°**ï¼š$$\frac{\partial L}{\partial z_1} = \frac{\partial L}{\partial h_1} \cdot \text{ReLU}'(z_1)$$



* **è®¡ç®—æŸå¤±å¯¹$h_1$çš„å¯¼æ•°**ï¼š$$\frac{\partial L}{\partial W_1} = \frac{\partial L}{\partial z_1} \cdot x^T$$



* **è®¡ç®—æŸå¤±å¯¹$b_1$çš„å¯¼æ•°**ï¼š$$\frac{\partial L}{\partial b_1} = \frac{\partial L}{\partial z_1}$$



### 4. æƒé‡æ›´æ–°

ä½¿ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•æˆ– Adam ä¼˜åŒ–å™¨æ¥æ›´æ–°æƒé‡ã€‚

**æ›´æ–°å…¬å¼**ï¼š$$W = W - \eta \cdot \frac{\partial L}{\partial W}$$



* $W$æ˜¯æƒé‡çŸ©é˜µï¼Œ$Î·$æ˜¯å­¦ä¹ ç‡ï¼Œ$\frac{\partial L}{\partial W}$ æ˜¯æŸå¤±å‡½æ•°å…³äºæƒé‡çš„æ¢¯åº¦ã€‚

æƒé‡æ›´æ–°æ­¥éª¤åœ¨æ¯ä¸€å±‚æ‰§è¡Œï¼š

* æ›´æ–° $W_1$,$W_2$,$W_3$å’Œå¯¹åº”çš„åç½®é¡¹$b_1$,$b_2$,$b_3$ã€‚

### 5. ä¼˜åŒ–å™¨ï¼ˆAdamï¼‰ä»‹ç»

Adam ä¼˜åŒ–å™¨é€šè¿‡ç»“åˆåŠ¨é‡å’Œè‡ªé€‚åº”å­¦ä¹ ç‡è¿›è¡Œå‚æ•°æ›´æ–°ã€‚è¯¦ç»†çš„æ›´æ–°å…¬å¼åœ¨ä¸Šé¢çš„å›ç­”ä¸­å·²ç»ç»™å‡ºã€‚

**1.ä¸€é˜¶åŠ¨é‡ä¼°è®¡:**
è®¡ç®—å½“å‰æ¢¯åº¦$\nabla_{\theta}L$çš„åŠ æƒå¹³å‡ï¼Œç”¨æ¥ä¼°è®¡æ¢¯åº¦çš„æœŸæœ›ã€‚è¿™ä¸ªä¸€é˜¶åŠ¨é‡ä¸»è¦æ˜¯ç´¯ç§¯ä¹‹å‰çš„æ¢¯åº¦ï¼Œä½¿å¾—æ›´æ–°æ–¹å‘æ›´åŠ å¹³æ»‘ã€‚

$$m_t = \beta_1 m_{t-1} + (1 - \beta_1) \nabla_{\theta}L$$
$\beta_1$æ˜¯ä¸€é˜¶åŠ¨é‡çš„è¡°å‡ç‡ï¼Œé€šå¸¸å–å€¼ä¸º 0.9ã€‚
$m_t$æ˜¯å½“å‰çš„åŠ¨é‡ï¼ˆæ¢¯åº¦çš„æŒ‡æ•°åŠ æƒå¹³å‡ï¼‰ã€‚

**2.äºŒé˜¶çŸ©ä¼°è®¡ï¼š**
è®¡ç®—å½“å‰æ¢¯åº¦å¹³æ–¹çš„åŠ æƒå¹³å‡ï¼Œä¼°è®¡æ¢¯åº¦çš„æ–¹å·®ï¼Œç”¨æ¥è°ƒèŠ‚å­¦ä¹ ç‡ï¼Œé¿å…æ›´æ–°æ­¥é•¿è¿‡å¤§ã€‚
$$v_t = \beta_2 v_{t-1} + (1 - \beta_2) (\nabla_{\theta}L)^2$$
$\beta_2$æ˜¯äºŒé˜¶åŠ¨é‡çš„è¡°å‡ç‡ï¼Œé€šå¸¸å–å€¼ä¸º 0.999ã€‚
$v_t$æ˜¯æ¢¯åº¦å¹³æ–¹çš„æŒ‡æ•°åŠ æƒå¹³å‡ã€‚

**3.åå·®ä¿®æ­£ï¼š**
ç”±äº$\hat{m}_t$å’Œ$\hat{v}_t$åœ¨å‰å‡ æ­¥å¯èƒ½ä¼šæœ‰è¾ƒå¤§çš„åå·®ï¼ŒAdam å¼•å…¥äº†åå·®ä¿®æ­£ï¼Œå‡å°‘ä¼°è®¡çš„åå·®ã€‚
$$\hat{m}_t = \frac{m_t}{1 - \beta_1^t}, \quad \hat{v}_t = \frac{v_t}{1 - \beta_2^t}$$
$\hat{m}_t$å’Œ$\hat{v}_t$æ˜¯åå·®ä¿®æ­£åçš„åŠ¨é‡å’ŒäºŒé˜¶çŸ©ä¼°è®¡.


**4.å‚æ•°æ›´æ–°ï¼š**
ä½¿ç”¨ä¿®æ­£åçš„åŠ¨é‡å’Œæ–¹å·®æ¥æ›´æ–°å‚æ•°ã€‚Adam çš„æ›´æ–°æ–¹å¼æ˜¯è‡ªé€‚åº”çš„ï¼Œèƒ½æ ¹æ®æ¢¯åº¦çš„å†å²åŠ¨æ€è°ƒæ•´å­¦ä¹ ç‡ã€‚
$$W_{t+1} = W_t - \eta \frac{\hat{m}_t}{\sqrt{\hat{v}_t} + \epsilon}
$$
$Î·$æ˜¯å­¦ä¹ ç‡ï¼Œé€šå¸¸å–å€¼åœ¨ 0.001 å·¦å³ã€‚
$ğœ–$æ˜¯ä¸€ä¸ªå°çš„å¹³æ»‘é¡¹ï¼Œé¿å…é™¤ä»¥é›¶ï¼Œé€šå¸¸ä¸º$10^{-8}$ ã€‚

---
### **Reference:**

1. [TensorFlow Documentation](https://www.tensorflow.org/guide)
2. [CS231n Convolutional Neural Networks for Visual Recognition](https://cs231n.github.io/neural-networks-1/)
3. [Adam Optimizer Paper](https://arxiv.org/abs/1412.6980)
4. [Gradient Descent and Backpropagation Overview](http://neuralnetworksanddeeplearning.com/chap2.html)
5. https://www.deeplearningbook.org/
6. http://cs231n.github.io/optimization-2/
------

